<template>
    <div :class="gridClass">
        <label>
            {{ label }}
            <span
                v-if="badgeDisplay"
                class="value-badge"
                :class="badgeStyle"
            >
                <span v-if="badgeOperation === 'sum'">
                    {{ badgeValue }}/{{badgeMax}}
                </span>
                <span v-else-if="badgeOperation === 'mult'">
                    <span v-if="value != null && value != ''">
                        x{{ badgeValue }}
                    </span>
                    <span v-else> -- </span>
                </span>
            </span>
        </label>
        <h1 v-if="type === 'display'" class="display-value">
            <div v-if="value != null && value !== ''">
                {{ value }} {{ displayAfter }}
            </div>
            <div v-else>
                -- {{ displayAfter }}
            </div>
        </h1>
        <input
            v-else
            :placeholder="placeholder"
            :type="type"
            v-model="localValue"
            :class="{'error-input': error}"
        />
    </div>
</template>

<script>
export default({
    name: 'Input',
    props: {
        grid: { default: 3 },
        label: { default: '' },
        placeholder: { default: '' },
        type: { default: 'text' },
        value: { default: '' },
        displayAfter: { default: '' },
        badgeDisplay: { default: true },
        badgeOperation: { default: 'sum' },
        badgeMax: { default: 3 },
        badgeRange: { default: () => [] },
        error: { default: false },
    },
    computed: {
        gridClass() {
            return 'grid-item-' + this.grid;
        },
    },
    data: () => ({
        localValue: '',
        badgeValue: '',
        badgeStyle: '',
    }),
    methods: {
        getOp(newValue) {
            if( this.value != '' && this.value != null && !this.error ) {
                return newValue;
            }
            return this.badgeOperation === 'sum' ? '-' : '--';
        },
        getBadge(value, range) {
            if( value != '' && value != null && !this.error ) {
                range.forEach((element) => {
                    const isBigger  = element.min ? element.min <= value : true;
                    const isSmaller = element.max ? element.max >= value : true;
                    if( isBigger && isSmaller ) {
                        this.badgeValue = this.getOp(element.value);
                        this.badgeStyle = element.style;
                    }
                });
            } else {
                this.badgeValue = this.getOp('');
                this.badgeStyle = '';
            }
        },
    },
    watch: {
        localValue(newValue) {
            this.$emit('input', newValue);
        },
        value(newValue) {
            this.localValue = newValue;
            this.getBadge(newValue, this.badgeRange);
        }
    },
    mounted() {
        this.badgeValue = this.getOp('');
    }
})
</script>

<style scoped>
    .value-badge {
        font-size: 12px;
        padding: 2px 8px;
        margin-left: 4px;
        border-radius: var(--border-radius);
        background-color: var(--color-background);
    }

    .display-value {
        padding-top: 8px;
        padding-bottom: 20px;
    }

    .error-input {
        background-color: var(--color-error-light);
        border-color: var(--color-error-dark);
    }
    .error-display {
        color: var(--color-error-dark);
        margin: -15px 0 20px 0;
    }
</style>
