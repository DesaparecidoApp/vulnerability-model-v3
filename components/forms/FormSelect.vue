<template>
    <div :class="gridClass">
        <label>
            {{ label }}
            <span
                v-if="badgeDisplay"
                class="value-badge"
                :class="badgeStyle"
            >
                <span v-if="badgeOperation === 'sum'">
                    {{ badgeValue }}/{{badgeMax}}
                </span>
                <span v-else-if="badgeOperation === 'mult'">
                    <span v-if="value != ''">
                        x{{ badgeValue }}
                    </span>
                    <span v-else> -- </span>
                </span>
            </span>
        </label>
        <select v-model="localValue">
            <option value='' disabled> {{ placeholder }} </option>
			<option v-for="option in options" :key="option.display" :value="option.display">
				{{option.display}}
			</option>
		</select>
    </div>
</template>

<script>
export default({
    name: 'Input',
    props: {
        grid: { default: 3 },
        label: { default: '' },
        placeholder: { default: '' },
        options: { default: () => [] },
        value: { default: '' },
        badgeDisplay: { default: true },
        badgeOperation: { default: 'sum' },
        badgeMax: { default: 3 },
    },
    computed: {
        gridClass() {
            return 'grid-item-' + this.grid;
        },
    },
    data: () => ({
        localValue: '',
        badgeValue: '',
        badgeStyle: '',
    }),
    methods: {
        getOp(newValue) {
            if( newValue != '') {
                return newValue;
            }
            return this.badgeOperation === 'sum' ? '-' : '--';
        },
        getBadge(value, range) {
            if( value !== '' ) {
                range.forEach((element) => {
                    if( element.display == value ) {
                        this.badgeValue = this.getOp(element.value);
                        this.badgeStyle = element.style;
                    }
                });
            } else {
                this.badgeValue = this.getOp('');
                this.badgeStyle = '';
            }
        },
    },
    watch: {
        localValue(newValue) {
            this.$emit('select', newValue);
        },
        value(newValue) {
            this.localValue = newValue;
            this.getBadge(newValue, this.options);
        }
    },
    mounted() {
        this.badgeValue = this.getOp('');
    }
})
</script>

<style scoped>
    .value-badge {
        font-size: 12px;
        padding: 2px 8px;
        margin-left: 4px;
        border-radius: var(--border-radius);
        background-color: var(--color-background);
    }

    .display-value {
        padding-top: 8px;
        padding-bottom: 20px;
    }

    .error-input {
        background-color: var(--color-error-light);
        border-color: var(--color-error-dark);
    }
    .error-display {
        color: var(--color-error-dark);
        margin: -15px 0 20px 0;
    }
</style>
